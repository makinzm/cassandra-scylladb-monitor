# 2026-02-23

## Issue #5 — JMX Exporter scrape failures and Cassandra OOM

### Problem 1: jmx_scrape_error 1.0 — missing jmxremote.password

**Symptom:** `http://localhost:7070/metrics` returned `jmx_scrape_error 1.0`.

**Root cause:** When `LOCAL_JMX=no`, `cassandra-env.sh` activates remote JMX with
`-Dcom.sun.management.jmxremote.authenticate=true` and
`-Dcom.sun.management.jmxremote.password.file=/etc/cassandra/jmxremote.password`,
but the official `cassandra:5` image ships without that file.

**Fix:** Added `jmx-exporter/jmxremote.password` (dev credentials `cassandra cassandra`)
and used an `entrypoint` override in `docker-compose.cassandra.yml` to install it into
the container with mode 400 at startup (`install -m 400`). Configured the JMX Exporter
with the same credentials via `username`/`password` in `jmx-exporter/cassandra.yml`.

**References:**
- https://github.com/apache/cassandra/blob/trunk/conf/cassandra-env.sh
- https://docs.oracle.com/en/java/javase/17/management/monitoring-and-management-using-jmx-technology.html

---

### Problem 2: Cassandra exit code 137 — OOM kill

**Symptom:** Cassandra container exited with code 137 (SIGKILL) immediately after
passing its healthcheck.

**Root cause:** `deploy.resources.limits.memory: 4G` exceeded Docker Desktop's total
available memory (3.8 GB). The container was killed by the OOM reaper before it could
stay up.

**Fix:** Lowered the Cassandra memory limit to `3G` and set `MAX_HEAP_SIZE: 1G` /
`HEAP_NEWSIZE: 256M` explicitly so the JVM heap stays within the container budget.
Rule of thumb: heap ≈ half the container memory limit.

**References:**
- https://github.com/apache/cassandra/blob/940739a4889794a5f198731b152c70e86bc95976/conf/cassandra-env.sh
